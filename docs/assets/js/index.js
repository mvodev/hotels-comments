(()=>{var p=class{constructor(t){this.observers=[],this.addCommentForm=t,this.nameError=document.querySelector(".js-add-comment__error_name_error"),this.nameInput=document.querySelector(".js-add-comment__name"),this.commentInput=document.querySelector(".js-add-comment__comment"),this.commentError=document.querySelector(".js-add-comment__error_comment_error"),this.addCommentForm.addEventListener("submit",this.handleSumbit.bind(this)),this.commentInput.addEventListener("input",this.handleInput.bind(this)),this.nameInput.addEventListener("input",this.handleInput.bind(this))}handleSumbit(t){t.preventDefault();let e=!1,n=new FormData(this.addCommentForm);if(n.get("name").length===0&&(this.nameError.textContent="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F",e=!0),n.get("comment").length===0&&(this.commentError.textContent="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439",e=!0),e)return;let m=new Date,i=m.getHours(),c=m.getMinutes(),h={id:Date.now(),name:n.get("name"),text:n.get("comment"),date:n.get("comment-date").length===0?new Date().toString():new Date(new Date(n.get("comment-date")).setHours(i,c)),likes:0};this.observers.forEach(o=>o.handleEvent("add",h))}handleInput(t){let e=t.target.classList.contains("js-add-comment__name"),n=t.target.classList.contains("js-add-comment__comment");e?this.nameError.textContent="":n&&(this.commentError.textContent="")}addObserver(t){this.observers.push(t)}removeObserver(t){this.observers=this.observers.filter(e=>e!==t)}};var g=class{constructor(){this.comments=[],this.observers=[]}addComment(t){this.comments.push(t)}addLikeToComment(t){let e=this.comments.find(n=>n.id===+t);e.likes+=1}removeLikeFromComment(t){let e=this.comments.find(n=>n.id===+t);e.likes-=1}deleteComment(t){let e=this.comments.findIndex(n=>n.id===+t);this.comments.splice(e,1)}getComments(){return this.comments}addObserver(t){this.observers.push(t)}removeObserver(t){this.observers=this.observers.filter(e=>e!==t)}};var D=class{constructor(t){this.commentsRoot=t;let e=document.querySelector(".js-add-comment");this.commentForm=new p(e),this.commentForm.addObserver(this),this.storage=new g,this.storage.addObserver(this)}handleEvent(t,e){if(t==="add"){let n="",m=new Date,i=m.getDate(),c=m.getMonth(),h=m.getFullYear(),o=new Date(e.date),_=o.getFullYear(),d=o.getMonth(),r=o.getDate(),b=`${r<10?`0${r}`:r}.${d<10?`0${d+1}`:d+1}.${_}`,v=o.getHours()<10?`0${o.getHours()}`:o.getHours(),f=o.getMinutes()<10?`0${o.getMinutes()}`:o.getMinutes();_===h&&d===c?i-r==1?n=`\u0432\u0447\u0435\u0440\u0430 ${v}:${f}`:r===i?n=`\u0441\u0435\u0433\u043E\u0434\u043D\u044F ${v}:${f}`:n=`${b}`:n=`${b}`;let s=document.createElement("li");s.setAttribute("data-id",e.id);let C=document.createElement("h2");C.textContent=`\u0418\u043C\u044F: ${e.name}`;let E=document.createElement("p"),L=document.createElement("span"),l=document.createElement("div");l.classList.add("comment__trash"),l.addEventListener("pointerdown",this.handleTrash.bind(this));let u=document.createElement("div");u.classList.add("comment__like"),u.addEventListener("pointerdown",this.handleLike.bind(this)),L.textContent=`\u0414\u0430\u0442\u0430: ${n}`,E.textContent=`Te\u043A\u0441\u0442 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F: ${e.text}`,s.append(C),s.append(E),s.append(L),s.append(l),s.append(u),s.classList.add("comment"),this.commentsRoot.append(s),this.storage.addComment(e)}}handleTrash(t){this.storage.deleteComment(t.target.parentElement.getAttribute("data-id")),this.commentsRoot.removeChild(t.target.parentElement)}handleLike(t){let e=t.target.parentElement.getAttribute("data-id");t.target.classList.contains("comment__like_is_liked")?(t.target.classList.remove("comment__like_is_liked"),this.storage.removeLikeFromComment(e)):(t.target.classList.add("comment__like_is_liked"),this.storage.addLikeToComment(e))}};document.querySelectorAll(".js-comments").forEach(a=>new D(a));})();
